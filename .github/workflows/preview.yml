'on':
    schedule:
      - cron: 0 6 * * 1-5
    workflow_dispatch: {}
name: Preview
jobs:
  hello:
    runs-on: ubuntu-latest
    steps:
      - name: my-step
        run: echo "Hello World!"
  build-and-test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: my-step
        run: echo "Hello World!"
      - uses: actions/checkout@v2
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d_%H-%M')"
      - name: Start new release cycle
        run: |2-

                  export version=`cat package.json | jq -r .version`
                  echo "Current version: $version"
                  echo "CURRENT_VERSION=${version}" >> $GITHUB_ENV
      - name: Get latest prerelease
        id: latestPrereleaseHash
        run: |2-

              git fetch --tags
              tagname=`git tag --list '*_PREVIEW_*' | tail -1`
              commitHash=git show-ref ${tagname} | awk '{print $1}'
              echo "IS_ALREADY_RELEASED=$commitHash" >> $GITHUB_ENV
              
      - name: Compare commit hashes
        id: isCommitHashEqual
        env:
          CURRENT_COMMIT_HASH: '${{ github.sha }}'
        run: |2-
              echo $hash
              echo ${CURRENT_COMMIT_HASH}
              if [ "$hash" = "${CURRENT_COMMIT_HASH}" ]; then
                  echo "::set-output isCommitHashEqual=true"
              else
                  echo "::set-output isCommitHashEqual=false"
              fi            
      - uses: actions/create-release@v1
        id: githubCreateRelease
        env:
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
        with:
          body: '${{ env.CURRENT_VERSION }}_PREVIEW_${{ steps.date.outputs.date }}'
          release_name: '${{ env.CURRENT_VERSION }}_PREVIEW_${{ steps.date.outputs.date }}'
          tag_name: '${{ env.CURRENT_VERSION }}_PREVIEW_${{ steps.date.outputs.date }}'
          prerelease: true
  hello2:
    runs-on: ubuntu-latest
    steps:
      - name: my-step2
        run: echo "Hello World2!"